<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>Create Blog - Blogify</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
    <style>
      body {
        background: #f4f4f7;
        font-family: 'Segoe UI', Arial, sans-serif;
      }
      .editor-container {
        max-width: 740px;
        margin: 40px auto;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 5px 24px 0 rgba(12, 32, 64, 0.1);
        overflow: hidden;
      }
      .editor-header {
        background: linear-gradient(112deg, #094eea 0%, #44c9e6 100%);
        color: #fff;
        padding: 32px 18px 20px 18px;
        font-weight: 700;
        font-size: 27px;
        letter-spacing: 1px;
        text-align: center;
      }
      .blog-title {
        width: 100%;
        border: none;
        border-bottom: 2px solid #f0f0f0;
        font-size: 22px;
        font-weight: 600;
        padding: 16px 18px;
        outline: none;
        margin: 0 0 15px 0;
        background: #fafaff;
      }
      .blog-title:focus {
        border-bottom-color: #2176ff;
        background: #fff;
      }
      .ql-toolbar.ql-snow {
        border: none;
        border-bottom: 1px solid #ddd !important;
        background: #fafaff !important;
        padding: 8px 14px !important;
      }
      .ql-container.ql-snow {
        border: none;
        min-height: 340px;
        font-size: 17px;
        padding-bottom: 10px;
      }
      .ql-editor {
        padding: 18px 18px !important;
        line-height: 1.65;
      }
      .ql-editor.ql-blank::before {
        font-style: normal !important;
        color: #7a869a !important;
        font-size: 16px !important;
      }
      .image-upload-container {
        text-align: center;
        border: 2px dashed #d1d5db;
        border-radius: 8px;
        padding: 18px;
        background: #f9fbfc;
        cursor: pointer;
        margin-bottom: 7px;
      }
      .image-upload-container:hover {
        border-color: #2176ff;
      }
      .upload-preview {
        max-width: 90%;
        max-height: 180px;
        margin-top: 12px;
        border-radius: 7px;
        display: none;
      }
      .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 7px;
        margin: 9px 0 3px 0;
      }
      .tag {
        background: #1890ff;
        color: #fff;
        padding: 3px 12px;
        border-radius: 16px;
        font-size: 13px;
        display: flex;
        align-items: center;
      }
      .tag-remove {
        margin-left: 6px;
        cursor: pointer;
        font-weight: bold;
      }
      .tag-input {
        padding: 7px 13px;
        border: 1px solid #ece9e9;
        border-radius: 6px;
        margin-right: 8px;
        outline: none;
        font-size: 15px;
      }
      .tag-input:focus {
        border-color: #2176ff;
      }
      .editor-footer {
        background: #fafaff;
        padding: 18px;
        border-top: 1px solid #eee;
        text-align: right;
      }
      .btn-primary {
        background: linear-gradient(112deg, #094eea 0%, #44c9e6 100%);
        color: #fff;
        border: none;
        padding: 12px 28px;
        border-radius: 7px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
      }
      .btn-primary:hover {
        background: linear-gradient(112deg, #2176ff 0%, #1190b6 100%);
      }
    </style>
  </head>
  <body>
    <%- include('./partials/navbar') %>
    <div class="editor-container">
      <div class="editor-header">Write Your Story</div>
      <form id="blogForm" action="/blog/create" method="POST" enctype="multipart/form-data" style="padding: 0 0 0 0;">
        <input type="text" name="title" class="blog-title" placeholder="Enter blog title..." required />

        <div id="editor"></div>
        <textarea name="content" id="hiddenContent" style="display:none"></textarea>

        <div style="padding: 18px;">
          <label for="coverImage" class="image-upload-container" style="display:block;">
            <span>ðŸ“¸ <span style="color:#444">Click to upload cover image</span></span>
            <img id="uploadPreview" class="upload-preview" alt="Preview" />
          </label>
          <input type="file" id="coverImage" name="coverImage" accept="image/*" style="display:none;"
            onchange="previewImage(this)" />
        </div>

        <div style="padding: 8px 18px 0 18px;">
          <input type="text" id="tagInput" class="tag-input" placeholder="Add tag and press Enter" autocomplete="off" />
          <div class="tags-container" id="tagsContainer"></div>
          <input type="hidden" name="tags" id="hiddenTags" />
        </div>

        <div class="editor-footer">
          <button type="submit" class="btn-primary">Publish Blog</button>
        </div>
      </form>
    </div>
    <%- include('./partials/scripts') %>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
      const quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
          toolbar: [
            ['bold', 'italic', 'underline'],
            [{ header: [1, 2, 3, false] }],
            [{ list: 'ordered' }, { list: 'bullet' }],
            ['link', 'image'],
            ['clean'],
          ]
        },
        placeholder: "Write your amazing story here..."
      });

      function previewImage(input) {
        const preview = document.getElementById('uploadPreview');
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      const tags = [];
      const tagInput = document.getElementById('tagInput');
      const tagsContainer = document.getElementById('tagsContainer');
      const hiddenTags = document.getElementById('hiddenTags');

      tagInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const tag = tagInput.value.trim();
          if (tag && !tags.includes(tag)) {
            tags.push(tag);
            updateTags();
            tagInput.value = '';
          }
        }
      });

      function updateTags() {
        tagsContainer.innerHTML = '';
        tags.forEach(function (tag) {
          const tagElem = document.createElement('div');
          tagElem.className = 'tag';
          tagElem.innerHTML = `${tag}<span class="tag-remove" onclick="removeTag('${tag}')">&times;</span>`;
          tagsContainer.appendChild(tagElem);
        });
        hiddenTags.value = tags.join(',');
      }

      window.removeTag = function(tag) {
        const idx = tags.indexOf(tag);
        if (idx > -1) {
          tags.splice(idx, 1);
          updateTags();
        }
      }

      document.getElementById('blogForm').addEventListener('submit', function (e) {
        document.getElementById('hiddenContent').value = quill.root.innerHTML;
        if (!document.querySelector('input[name="title"]').value.trim()) {
          e.preventDefault();
          alert("Please enter a blog title");
        }
      });
    </script>
  </body>
</html>
